# Global Claude Code Instructions

## Identity
<!-- Replace with your own userModel or remove this section -->
<!-- @userModels/yourname/model.md -->

## Principles
- Assumptions are the enemy. Benchmark, don't estimate.
- Validate at small scale first. Run sub-minute versions before full pipelines.
- Ground truth understanding before coding. Research, clarify, persist plan, execute.
- Building from scratch can beat adapting legacy code with architectural baggage.
- When user defines constraints ("never X", "always Y"), persist to project's CLAUDE.md.

## Tools
- Firecrawl or Jina for scraping (`jina` for Twitter/X). OSGrep over grep. Beads (`bd`) for tasks.
- `beautiful-mermaid` for Mermaid diagrams: `node ~/.claude/skills/beautiful-mermaid/scripts/mermaid.mjs --help`
- `nano-banana-pro` for image generation/editing (Gemini 3 Pro Image)
- `gemini-claude-resonance` for cross-model visual dialogue
- Python: use uv for everything (`uv run`, `uv pip`, `uv venv`)
- `grip` for GitHub-flavored README preview—run `grip <file.md> [port]` to render markdown exactly as GitHub would
- **RLAMA**: Always use retrieve-only mode (`rlama_retrieve.py`)—Claude synthesizes from raw chunks. Never route through Qwen when Claude is in the loop. `rlama run` is fallback only.

### Web Scraping
- **Firecrawl**: `firecrawl --help` for web scraping to Markdown
- **Jina**: `jina --help` — use for Twitter/X (Firecrawl blocks Twitter)

### Search
- **OSGrep**: Semantic code search — prefer over traditional grep
- **exa-search skill**: Web search and code examples

### External Info
- **MCP servers**: Use before guessing. context7 for library docs (resolve-library-id first)

### Task Tracking
- **Beads** (`bd`): Dependency-aware task tracking across sessions

### API Keys & Billing
- **Central store**: `~/.config/env/global.env` — management/billing keys for all providers
- **OpenRouter usage**: `python3 ~/.claude/skills/openrouter-usage/scripts/openrouter_usage.py`
- Keys in global.env: `OPENROUTER_MANAGEMENT_KEY`, `FIRECRAWL_API_KEY`, `EXA_API_KEY`
- Per-skill `.env` files also checked as fallback

## Interaction
- Clarify unclear requests, then proceed autonomously.
- Only ask for help at genuine blockers (timeouts >2min, sudo, ambiguous intent).
- No "Generated by Claude Code" in commits. Env variables: case-insensitive.
- Em dashes: no spaces, attached to text (e.g. "skills—Slack" not "skills — Slack").

## Planning
- Spec-driven: create/update SPEC.md for non-trivial projects. Re-read when stuck or after compaction.
- **Plan files**: `~/.claude/plans/{project-name}-{date}-{topic}.md` — include project path for linking.

## Always Loaded
<!-- Point these at your own agent_docs if you maintain them -->
<!-- @agent_docs/active-projects.md -->
<!-- @agent_docs/skills.md -->

## On-Demand References
<!-- Add references to docs you want Claude to read on-demand -->
<!-- Example: -->
<!-- - `~/.claude/agent_docs/local-ml.md` — Ollama, HuggingFace, MLX, llama.cpp -->
<!-- - `~/.claude/agent_docs/local-rag.md` — rlama usage & RAG collections -->
<!-- - `~/.claude/agent_docs/mcp-servers.md` — MCP server setup & config -->

## Session Continuity
- **Handoffs**: `~/.claude/handoffs/INDEX.md` — auto-maintained index of recent sessions (date, project, trigger, summary)
- On session start or after crash, read INDEX.md to recover context from prior sessions
- Individual handoff YAMLs: `~/.claude/handoffs/{session_id}.yaml` (objective, completed, decisions, blockers, next_steps)
- Triggers: `compact` (context full), `stop` (every 5 min), `prompt_input_exit`/`other` (graceful exit)

## Infrastructure
- `~/.claude/` is a git repo. Commit notable changes periodically.
- Hooks in `~/.claude/hooks/` (see `settings.json` for bindings)
- Custom commands in `~/.claude/commands/`
- Model & agent config: see `~/.claude/agent_docs/claude-code-config.md`
