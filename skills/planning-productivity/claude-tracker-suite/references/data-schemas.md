# Data Schemas

## sessions-index.json

Located at `~/.claude/projects/<encoded-dir>/sessions-index.json`. Each project directory has one.

```json
{
  "entries": [
    {
      "sessionId": "079684a1-9df5-41bd-b504-cd2a152c80f7",
      "projectPath": "/Users/name/project",
      "summary": "Auto-generated summary by Claude Code",
      "customTitle": "User-set title (overrides summary)",
      "firstPrompt": "First user message text",
      "messageCount": 42,
      "created": "2026-02-05T12:00:00.000Z",
      "modified": "2026-02-05T13:00:00.000Z",
      "gitBranch": "main",
      "isSidechain": false
    }
  ]
}
```

**Key fields:**
- `customTitle` takes priority over `summary` for display
- `isSidechain` — filtered out by search (observer/background sessions)
- `projectPath` — ground truth path (used instead of encoded dir name)

## session-summaries.json

Cache at `~/.claude/session-summaries.json`. Flat map of session ID to summary data.

```json
{
  "079684a1-9df5-41bd-b504-cd2a152c80f7": {
    "title": "Port Strip Functions",
    "summary": "Updated utils.ts to use LineProcessor with LRU caching",
    "first_msg": "Now rewrite the strip functions...",
    "model": "opus-4.6",
    "num_turns": 12,
    "total_cost_usd": 0.45,
    "source": "auto-named"
  }
}
```

**Fields added by enrichment:**
- `model` — short model name from JSONL assistant messages
- `num_turns` — count of `system.subtype=turn_duration` entries
- `total_cost_usd` — from `result.total_cost_usd` or `costUsd` fields
- `source` — "auto-named" if generated by one-shot Claude call

## JSONL Transcript Format

Session files at `~/.claude/projects/<dir>/<session-id>.jsonl`. One JSON object per line.

| type | subtype | Key fields |
|------|---------|------------|
| `user` | — | `message.content`, `timestamp`, `isMeta` |
| `assistant` | — | `message.model`, `message.usage.{input_tokens, output_tokens, cache_*}`, `message.id` |
| `system` | `turn_duration` | `durationMs` |
| `system` | `init` | `mcp_servers`, `permissionMode`, `skills`, `agents` |
| `result` | — | `total_cost_usd`, `num_turns` |
| `summary` | — | `summary` (AI-generated session summary) |
| `progress` | — | Tool execution progress |

## Encoded Directory Names

Project directories under `~/.claude/projects/` use hyphen-encoding:
```
/Users/jane/Desktop/Aldea → -Users-jane-Desktop-Aldea
```

**Decoding priority:**
1. Read `projectPath` from `sessions-index.json` (ground truth)
2. Fall back to filesystem walk heuristic (`resolvePathHeuristic`)

The heuristic is lossy because real hyphens in directory names collide with path separators.

## Data Source Locations

| Source | Location | Content |
|--------|----------|---------|
| Session index | `~/.claude/projects/*/sessions-index.json` | Summary, firstPrompt, sessionId, timestamps, branch, projectPath |
| Summary cache | `~/.claude/session-summaries.json` | Cached titles, summaries, model, turn count, cost |
| Session files | `~/.claude/projects/*/*.jsonl` | Full conversation transcripts (NDJSON) |
| Active projects | `~/.claude/agent_docs/active-projects.md` | Curated project list with sessions, model, turns, cost |
| Watcher PID | `~/.claude/.tracker-watch.pid` | Daemon process tracking |

## Shared Library API

All tracker scripts use `~/.claude/lib/tracker-utils.js`:

| Function | Purpose |
|----------|---------|
| `loadSessionsIndex()` | Load all sessions-index.json into flat array |
| `loadSummaryCache()` | Load cached summaries |
| `parseSession()` | Parse JSONL for messages, keywords, metadata |
| `parseSessionEnriched()` | Extract model, tokens, turns, duration, cost, worktree status from JSONL |
| `buildSessionStatus()` | Detect running/VS Code status per session |
| `getRunningClaudeSessions()` | Find active Claude processes via pgrep+lsof |
| `getAllSessionFiles()` | List all session JSONL files sorted by mtime |
| `decodeProjectPath()` | Convert encoded dir names to real paths |
| `formatAge()` | Human-readable time formatting |
